# Alerting
A hyprland project that alerts the user when their battery is low by changing the borders of windows.

This program uses color interpolation to change the color of active or inactive (or both), windows to represent the current battery percentage.

## Legal Licensing
Can you use this for your project? Yes, you can as long as you keep your own project under the same license (I think, read the license).

## Mathematical interpolation
The used interpolation method can be by editing the `interpolation_nth_degree.sh` script, or by simply changing the reference in the `int compile_calculate(int a, int b, int n, int t)` function located in the `precompile.c` file. The default color interpolation is applied individually on every color value (red, green and blue) based on a scaled parametric function where `t` is within the range [1,100] instead of [0,1]. The default interpolation is a function of Nth degree, where N can be modified by editing the `config_interpolation_degree` value of the configuration file (see Configuring section). It follows the rule: `(T^N)((B-A)/(100^N))+A`, where A is the starting color, B is the final color, N is the interpolation degree, and T is the parametric value ranging from 1 to 100.

### Preview Color Transition
This will be added later.

## Configuring
You want to change the colors, your hyprland configuration is located in the weirdest place possible? You aren't even using hyprland and are modifiying this to fit for your needs? The config file will help you with whatever you are doing. Feel free to modify it to your desires!

All values are explained in the `alerting.ini` configuration file, but you may want these comments gone for clarity of your settings, so here is a copy of the descriptions (with more details!).

| Values | Descriptions | Default Values |
|:---:|:---:|:---:|
| config_start_r | The amount of red in the beginning color -- when the battery is sitting at 100%. | 111 |
| config_start_g | The amount of green in the beginning color -- when the battery is sitting at 100%. | 201 |
| config_start_b | The amount of blue in the beginning color -- when the battery is sitting at 100%. | 141 |
| config_end_r | The amount of red in the beginning color -- when the battery reaches 0%. | 181 |
| config_end_g | The amount of green in the beginning color -- when the battery reaches 0%. | 4 |
| config_end_b | The amount of blue in the beginning color -- when the battery reaches 0%. | 10 |
| config_offset | Shifts the value of an index. For example, with an offset of 1, the value at T=1 is what would have been T=0, at T=50, T=49, etc. | 1 |
| config_interpolation_degree | The degree argument passed to the script for precompiling the interpolation between colors. | 5 |
| segment_header | The beginning section of the precompiled script. | ```%h#!/bin/bash<br>%h# File generated by precompile.c<br>%hcase "$1" in``` |
| segment_repeated | The section of the precompiled script that is repeated for each value of T from 1 to 100. The % & $ # symbols are used as formatting: % is replaced with the respective value of T, & is replaced with the hexadecimal red value at T, $ is replaced with the hexadecimal green value at T, and # is replaced with the hexadecimal blue value at T. | ```%r"%")<br>%r  echo "0xff&$#"<br>%r  ;;``` |
| segment_footer | The final section of the precompiled script used for the case of a wrong input. | ```%f*)<br>%f  echo "0xff000000"<br>%f  ;;<br>%fesac``` |

### System Configuration
> [!WARN]
> This is for Arch Linux!

> [!CAUTION]
> This is not yet functional and will crash your computer [for some reason]. The debugging process is still happening.

To run the script when the battery percentage changes, you have to register a udev rule.

Making a systemd service would require checking the battery percentage at intervals which is inefficient. Using udev allows the script to only be triggered when the battery percentage changes.

To register the rule correctly, first run the `ls /sys/class/power_supply/` to see the name of your battery. You are looking for a name like `BAT0` or `BAT1`. If you see `ACAD`, this is the AC adapter. Using this will only trigger the script when you plug or unplug your computer. Now jump to the `alerting.rules` files and modify the `KERNEL` value to the name of your battery, and `RUN` to this path.

After modifying the `alerting.rules` file here, move it with the other udev scripts.

First make sure that there are no rules named `alerting` with this command:
```sh
[[ -f /etc/udev/rules.d/alerting.rules ]] && echo -e "\nWARN: There is already a rule with the name: 'alerting.rules'." || echo -e "\nINFO: You're good to go! There is no rule with the same name."
```
> [!NOTE]
> If your rule has a different name or path, use this modifiable command:
> ```sh
> RULE_NAME="alerting.rules"
> RULE_PATH="/etc/udev/rules.d/"
> [[ -f $RULE_PATH$RULE_NAME ]] && echo -e "\nWARN: There is already a rule with the name: '$RULE_NAME'" || echo -e "\nINFO: You're good to go! There is no rule with the same name."
> ```
If there is a rule with the same name, rename it, then you're good to go.

When you're good to go, move the rule to its desired location using this command:
```sh
[[ -f "/etc/udev/rules.d/alerting.rules" ]] && echo -e "\nWARN: There is already a rule with the name 'alerting.rules'." \
|| { [[ -f alerting.rules ]] && sudo mv alerting.rules /etc/udev/rules.d/ && echo -e "\nINFO: 'alerting.rules' has been moved to '/etc/udev/rules.d/'." || echo -e "\nWARN: There is no file with the name 'alerting.rules' in this path or the displacement was unsuccessful."; }
```
> [!NOTE]
> If your rule has a different name or path, use this modifiable command:
> ```sh
> RULE_NAME="alerting.rules"
> RULE_PATH="/etc/udev/rules.d/"
> [[ -f $RULE_PATH$RULE_NAME ]] && echo -e "\nWARN: There is already a rule with the '$RULE_NAME.'" \
> || { [[ -f $RULE_NAME ]] && sudo mv $RULE_NAME $RULE_PATH && echo -e "\nINFO: '$RULE_NAME' has been moved to '$RULE_PATH'." || echo -e "\nWARN: There is no file with the name '$RULE_NAME' in this path or the displacement was unsuccessful."; }
> ```

Now, reload rules with this command: `sudo udevadm control --reload-rules`, and it should work!
